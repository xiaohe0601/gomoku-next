# 五子棋道具机制修复计划

## 问题分析与修复方案

### 1. 「混沌打击」效果修复
**问题**：当前只打印日志，没有实际移除对手棋子
**修复方案**：
- 在Board类中添加按位置移除棋子的方法
- 修改performChaosStrike方法，实际移除对手棋子

### 2. 「精准打击」效果修复
**问题**：没有进入选择模式，无法指定移除对手棋子
**修复方案**：
- 实现选择模式逻辑，允许玩家点击选择要移除的对手棋子
- 添加点击事件处理，处理精准打击的目标选择

### 3. 「加速落子」效果修复
**问题**：没有实现额外落子机会
**修复方案**：
- 添加额外落子机会的状态管理
- 修改makeMove方法，在当前回合不切换玩家

### 4. 「策略指引」显示时间修复
**问题**：推荐位置3秒后自动消失，应该在落子后消失
**修复方案**：
- 修改showStrategyGuide方法，移除3秒自动关闭逻辑
- 在玩家落子后手动清除策略指引

### 5. 「自我失误」效果修复
**问题**：当前只打印日志，没有实际移除自己棋子
**修复方案**：
- 修改performSelfMistake方法，实际移除自己棋子
- 调用Board类的移除棋子方法

### 6. 「对手加速」效果修复
**问题**：没有实现对手额外落子机会
**修复方案**：
- 记录对手获得额外落子机会
- 在对手回合不切换玩家

### 7. 「手滑惩罚」效果修复
**问题**：没有限制落子位置
**修复方案**：
- 实现限制落子位置的逻辑
- 生成3个随机可选位置并标记
- 在落子前检查位置是否允许

### 8. 状态栏拆分
**问题**：只有一个状态栏，道具状态混乱
**修复方案**：
- 拆分为两个状态栏，分别显示黑白双方的道具状态
- 为每个玩家创建独立的状态栏

## 修复步骤

### 第一步：Board类扩展
- 添加按位置移除棋子的方法
- 确保棋子移除后正确更新棋盘状态

### 第二步：GomokuGame类修复
- 实现各种道具效果的具体逻辑
- 添加额外落子机会的状态管理
- 实现选择模式和位置限制逻辑

### 第三步：CanvasRenderer类修复
- 实现选择模式的视觉反馈
- 实现手滑惩罚的位置标记
- 修改策略指引的显示逻辑

### 第四步：GameUI类修复
- 拆分为两个状态栏
- 分别显示黑白双方的道具状态
- 确保状态栏正确更新

### 第五步：测试验证
- 测试所有道具效果
- 确保状态栏正确显示
- 验证游戏流程正常

## 预期效果

- 所有道具效果正常触发
- 精准打击可以选择目标棋子
- 加速落子可以获得额外落子机会
- 策略指引在落子后消失
- 自我失误可以移除自己棋子
- 对手加速让对手获得额外落子
- 手滑惩罚限制落子位置
- 两个状态栏分别显示双方状态

## 技术要点

- 正确管理游戏状态和玩家状态
- 实现流畅的UI交互
- 确保游戏逻辑的一致性
- 修复后的道具效果符合预期
- 状态栏清晰展示双方状态

## 修复文件列表

1. `src/game/Board.ts` - 添加棋子移除方法
2. `src/game/GomokuGame.ts` - 修复所有道具效果
3. `src/ui/CanvasRenderer.ts` - 修复视觉效果
4. `src/ui/GameUI.ts` - 拆分状态栏
5. `src/styles.css` - 更新状态栏样式

## 验证方法

- 手动测试每种道具效果
- 验证状态栏显示正确
- 确保游戏流程正常
- 检查控制台是否有错误