# 五子棋盲盒道具机制实现计划

## 1. 类型定义扩展

### 1.1 道具类型枚举
- 添加 `ItemType` 枚举，包含5种强化类和3种弱化类道具
- 添加 `ItemRarity` 枚举，定义道具稀有度

### 1.2 道具接口
- 定义 `Item` 接口，包含道具类型、名称、描述、效果等属性
- 定义 `BlindBox` 接口，包含位置、状态等属性
- 定义 `ItemEffect` 接口，描述道具效果

### 1.3 游戏状态扩展
- 扩展 `GameState` 枚举，添加道具相关状态
- 扩展 `GameConfig` 接口，添加道具配置

## 2. 核心逻辑实现

### 2.1 盲盒生成机制
- 修改 `GomokuGame` 类，添加 `generateBlindBox` 方法
- 在 `makeMove` 方法中添加盲盒生成逻辑
- 确保盲盒生成在有效空白位置

### 2.2 道具效果实现
- 为每种道具实现具体的效果逻辑
- 添加 `applyItemEffect` 方法处理道具效果
- 实现道具效果的即时和延迟触发

### 2.3 道具状态管理
- 添加 `items` 数组管理玩家拥有的道具
- 添加 `activeEffects` 数组管理当前生效的效果
- 实现道具生命周期管理

## 3. UI交互设计

### 3.1 盲盒和道具绘制
- 修改 `CanvasRenderer` 类，添加盲盒绘制逻辑
- 实现道具图标的绘制
- 添加道具名称显示效果

### 3.2 道具说明弹窗
- 在 `GameUI` 中添加道具说明按钮
- 实现弹窗组件，显示所有道具详细说明

### 3.3 状态栏设计
- 添加状态栏，显示玩家拥有的道具
- 实现鼠标悬浮交互，显示道具详细信息
- 为持续效果道具设计状态图标

## 4. 交互流程实现

### 4.1 核心交互流程
```
落子 → 判定有效 → 生成盲盒 → 检查落子位置是否有盲盒 → 开启盲盒 → 触发道具效果 → 显示道具名称 → 更新状态栏
```

### 4.2 道具效果触发流程
- 即时效果：立即执行并显示
- 持续效果：显示状态栏图标，直至失效
- 选择效果：弹出选择界面，等待玩家操作

## 5. 代码修改计划

### 5.1 修改的文件
- `src/game/types.ts`：添加类型定义
- `src/game/GomokuGame.ts`：添加道具和盲盒逻辑
- `src/ui/CanvasRenderer.ts`：添加绘制逻辑
- `src/ui/GameUI.ts`：添加UI交互
- `src/styles.css`：添加样式

### 5.2 新增的文件
- `src/game/ItemSystem.ts`：道具系统核心逻辑
- `src/game/BlindBox.ts`：盲盒管理
- `src/ui/ItemUI.ts`：道具UI组件

## 6. 实现步骤

1. **类型定义扩展**：添加道具和盲盒相关的类型定义
2. **核心逻辑实现**：实现盲盒生成和道具效果逻辑
3. **UI绘制实现**：实现盲盒、道具图标和状态的绘制
4. **交互设计实现**：实现道具说明弹窗和状态栏
5. **测试和优化**：测试所有道具效果和交互流程

## 7. 预期效果

- 每次落子后随机生成盲盒
- 落子位置有盲盒时自动开启
- 触发对应道具效果
- 显示道具名称1秒
- 持续效果道具在状态栏显示图标
- 支持道具说明弹窗和鼠标悬浮交互

## 8. 技术难点

- 道具效果与现有游戏逻辑的兼容
- 复杂道具效果的状态管理
- UI交互的流畅性和直观性
- 游戏平衡性的保持

## 9. 注意事项

- 确保道具机制不破坏游戏的核心玩法
- 保持游戏的公平性和可玩性
- 提供清晰的道具说明和交互指引
- 优化性能，避免频繁绘制影响游戏流畅度